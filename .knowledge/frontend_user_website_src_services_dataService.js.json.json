{"is_source_file": true, "format": "JavaScript", "description": "This file provides a data service module for interacting with a Supabase backend, including user authentication, profile management, and request handling functions. It normalizes data, enforces constraints, and exposes an API for other parts of the application.", "external_files": ["./statusUtils", "./supabaseClient", "../config/appConfig", "../utils/withTimeout"], "external_methods": ["getSupabase", "normalizeStatus", "withTimeout"], "published": ["dataService"], "classes": [], "methods": [{"name": "supaUserToAppUser", "description": "Converts a Supabase auth user object into a minimal app user object, including role and approval status, with fallback to create profile if missing."}, {"name": "normalizeVehicle", "description": "Normalizes vehicle data from database row or input object to a consistent {make, model} format."}, {"name": "normalizeContact", "description": "Normalizes contact data from database row or input object to a consistent {name, phone} format."}, {"name": "forceUserCreateStatusOpen", "description": "Ensures request payload has status set to 'open' and strips any caller-provided status."}, {"name": "normalizeSupabaseAuthError", "description": "Converts various Supabase auth error messages into user-friendly strings."}, {"name": "register", "description": "Registers a new user with email and password via Supabase auth."}, {"name": "login", "description": "Logs in a user with email and password via Supabase auth."}, {"name": "loginWithGoogle", "description": "Initiates OAuth login with Google via Supabase."}, {"name": "logout", "description": "Signs out the current user via Supabase."}, {"name": "getUserFromSession", "description": "Retrieves the current authenticated user based on session cache."}, {"name": "getCurrentUser", "description": "Retrieves the current authenticated user directly from Supabase."}, {"name": "subscribeToAuthChanges", "description": "Subscribes to auth state changes, providing immediate minimal user info and background enrichment."}, {"name": "getProfile", "description": "Fetches user profile data from 'public.profiles' table."}, {"name": "listRequests", "description": "Lists requests, optionally filtered by user ID, normalizing data for UI."}, {"name": "getRequestById", "description": "Fetches a specific request by ID, normalizing data for UI."}, {"name": "createRequest", "description": "Creates a new request with enforced 'open' status and normalized data."}, {"name": "isSupabaseConfigured", "description": "Checks if Supabase environment variables are configured (always returns true here)."}], "calls": ["getSupabase", "normalizeStatus", "withTimeout", "supabase.auth.signUp", "supabase.auth.signInWithPassword", "supabase.auth.signInWithOAuth", "supabase.auth.signOut", "supabase.auth.getSession", "supabase.auth.getUser", "supabase.from", "supabase.from().select", "supabase.from().insert", "supabase.from().eq", "supabase.from().maybeSingle", "supabase.auth.onAuthStateChange"], "search-terms": ["dataService", "Supabase auth", "profile management", "request creation", "normalize vehicle", "normalize contact", "auth state change", "createRequest", "listRequests", "getRequestById"], "state": 2, "file_id": 73, "knowledge_revision": 629, "git_revision": "5f64b6421409fd8c8a1a0b94d8166a832c679158", "revision_history": [{"352": "15b5e00133c728e31f7cfdd11b3f578418e3e946"}, {"498": "4df64072ecff4147ced1d3bd08d6f9db6d098f5b"}, {"502": "40fbc15814f3eb78e86fa58f45962c80516c6a2f"}, {"506": "40fbc15814f3eb78e86fa58f45962c80516c6a2f"}, {"507": "858bd544d4145b53d875745a371f7d93eb79e402"}, {"508": "6975d6bdc8fdcedd670d3c075567e32ed6853ff4"}, {"510": "ce807ae69b7652497756a309ba3b8200602259df"}, {"551": "5f64b6421409fd8c8a1a0b94d8166a832c679158"}, {"582": "5f64b6421409fd8c8a1a0b94d8166a832c679158"}, {"629": "5f64b6421409fd8c8a1a0b94d8166a832c679158"}], "ctags": [], "filename": "frontend_user_website/src/services/dataService.js", "format-version": 4, "code-base-name": "https://github.com/kavia-common/roadrescue-quickassist-platform-41193-41202.git:kavia-main"}