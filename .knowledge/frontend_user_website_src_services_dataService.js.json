{"is_source_file": true, "format": "JavaScript", "description": "This file provides a data service interface for handling user authentication, profile management, and request operations using Supabase. It includes functions for user registration, login, logout, profile retrieval, and managing requests related to vehicle issues, with utilities for normalizing data and error handling.", "external_files": ["./statusUtils", "./supabaseClient", "../config/appConfig", "../utils/withTimeout"], "external_methods": ["normalizeStatus", "getSupabase", "withTimeout"], "published": ["dataService"], "classes": [], "methods": [{"name": "supaUserToAppUser(supaUser)", "description": "Converts a Supabase auth user object into a simplified app user object, attempting to read role and approval status from profiles table.", "scope": "", "scopeKind": ""}, {"name": "normalizeVehicle(vehicle, row)", "description": "Normalizes vehicle data from input or row data into a standardized object with 'make' and 'model'.", "scope": "", "scopeKind": ""}, {"name": "normalizeContact(contact, row)", "description": "Normalizes contact information from input or row data into a standardized object with 'name' and 'phone'.", "scope": "", "scopeKind": ""}, {"name": "normalizeSupabaseAuthError(err)", "description": "Converts Supabase error objects into user-friendly error messages.", "scope": "", "scopeKind": ""}, {"name": "register(email, password)", "description": "Registers a new user with email and password via Supabase, returning a minimal app user object.", "scope": "dataService", "scopeKind": "class"}, {"name": "login(email, password)", "description": "Logs in a user with email and password via Supabase, returning a minimal app user object.", "scope": "dataService", "scopeKind": "class"}, {"name": "loginWithGoogle({ redirectTo } = {})", "description": "Initiates OAuth login flow with Google via Supabase.", "scope": "dataService", "scopeKind": "class"}, {"name": "logout()", "description": "Logs out the current user via Supabase.", "scope": "dataService", "scopeKind": "class"}, {"name": "getCurrentUser()", "description": "Retrieves the current authenticated user object, if any.", "scope": "dataService", "scopeKind": "class"}, {"name": "subscribeToAuthChanges(onUserChanged)", "description": "Subscribes to authentication state changes; calls callback on user changes.", "scope": "dataService", "scopeKind": "class"}, {"name": "getProfile(userId)", "description": "Fetches the user profile data from the 'profiles' table for a given user ID.", "scope": "dataService", "scopeKind": "class"}, {"name": "listRequests({ forUserId } = {})", "description": "Lists requests from the 'requests' table, optionally filtered by user ID.", "scope": "dataService", "scopeKind": "class"}, {"name": "getRequestById(requestId)", "description": "Fetches a specific request record by ID.", "scope": "dataService", "scopeKind": "class"}, {"name": "createRequest({ user, vehicle, issueDescription, contact })", "description": "Creates a new vehicle service request in the database with normalized data.", "scope": "dataService", "scopeKind": "class"}, {"name": "isSupabaseConfigured()", "description": "Returns true if Supabase environment variables are detected (static check).", "scope": "dataService", "scopeKind": "class"}], "calls": ["getSupabase()", "withTimeout()", "supabase.auth.signUp()", "supabase.auth.signInWithPassword()", "supabase.auth.signInWithOAuth()", "supabase.auth.signOut()", "supabase.auth.getUser()", "supabase.auth.onAuthStateChange()", "supabase.from('profiles').select()", "supabase.from('profiles').insert()", "supabase.from('requests').select()", "supabase.from('requests').insert()"], "search-terms": ["dataService", "Supabase auth", "vehicle normalization", "request management", "profile handling", "user registration", "OAuth login", "request creation", "list requests", "get request by ID"], "state": 2, "file_id": 73, "knowledge_revision": 457, "git_revision": "21c90acbee21bc1eaecca96350a00fd5e6389cbd", "revision_history": [{"352": "15b5e00133c728e31f7cfdd11b3f578418e3e946"}, {"420": "adddec63496c05acbad8f707fc07bd60b2d8ca52"}, {"430": "fe63037cb13ed9778021272beaaedbedfeec96f2"}, {"440": "fe63037cb13ed9778021272beaaedbedfeec96f2"}, {"457": "21c90acbee21bc1eaecca96350a00fd5e6389cbd"}], "ctags": [{"_type": "tag", "name": "assigned_mechanic_email", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^      assigned_mechanic_email: null,$/", "language": "JavaScript", "kind": "property", "scope": "dataService.createRequest.insertPayload", "scopeKind": "class"}, {"_type": "tag", "name": "assigned_mechanic_id", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^      assigned_mechanic_id: null,$/", "language": "JavaScript", "kind": "property", "scope": "dataService.createRequest.insertPayload", "scopeKind": "class"}, {"_type": "tag", "name": "contact", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^      contact: safeContact,$/", "language": "JavaScript", "kind": "property", "scope": "dataService.createRequest.insertPayload", "scopeKind": "class"}, {"_type": "tag", "name": "createRequest", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^  async createRequest({ user, vehicle, issueDescription, contact }) {$/", "language": "JavaScript", "kind": "method", "signature": "({ user, vehicle, issueDescription, contact })", "scope": "dataService", "scopeKind": "class"}, {"_type": "tag", "name": "created_at", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^      created_at: nowIso,$/", "language": "JavaScript", "kind": "property", "scope": "dataService.createRequest.insertPayload", "scopeKind": "class"}, {"_type": "tag", "name": "dataService", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^export const dataService = {$/", "language": "JavaScript", "kind": "class"}, {"_type": "tag", "name": "getCurrentUser", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^  async getCurrentUser() {$/", "language": "JavaScript", "kind": "method", "signature": "()", "scope": "dataService", "scopeKind": "class"}, {"_type": "tag", "name": "getProfile", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^  async getProfile(userId) {$/", "language": "JavaScript", "kind": "method", "signature": "(userId)", "scope": "dataService", "scopeKind": "class"}, {"_type": "tag", "name": "getRequestById", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^  async getRequestById(requestId) {$/", "language": "JavaScript", "kind": "method", "signature": "(requestId)", "scope": "dataService", "scopeKind": "class"}, {"_type": "tag", "name": "insertPayload", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^    const insertPayload = {$/", "language": "JavaScript", "kind": "class", "scope": "dataService.createRequest", "scopeKind": "class"}, {"_type": "tag", "name": "isSupabaseConfigured", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^  isSupabaseConfigured() {$/", "language": "JavaScript", "kind": "method", "signature": "()", "scope": "dataService", "scopeKind": "class"}, {"_type": "tag", "name": "issue_description", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^      issue_description: issueDescription,$/", "language": "JavaScript", "kind": "property", "scope": "dataService.createRequest.insertPayload", "scopeKind": "class"}, {"_type": "tag", "name": "listRequests", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^  async listRequests({ forUserId } = {}) {$/", "language": "JavaScript", "kind": "method", "signature": "({ forUserId } = {})", "scope": "dataService", "scopeKind": "class"}, {"_type": "tag", "name": "login", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^  async login(email, password) {$/", "language": "JavaScript", "kind": "method", "signature": "(email, password)", "scope": "dataService", "scopeKind": "class"}, {"_type": "tag", "name": "loginWithGoogle", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^  async loginWithGoogle({ redirectTo } = {}) {$/", "language": "JavaScript", "kind": "method", "signature": "({ redirectTo } = {})", "scope": "dataService", "scopeKind": "class"}, {"_type": "tag", "name": "logout", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^  async logout() {$/", "language": "JavaScript", "kind": "method", "signature": "()", "scope": "dataService", "scopeKind": "class"}, {"_type": "tag", "name": "make", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^      make: vehicle && typeof vehicle.make === \"string\" ? vehicle.make : \"\",$/", "language": "JavaScript", "kind": "property", "scope": "dataService.createRequest.safeVehicle", "scopeKind": "class"}, {"_type": "tag", "name": "model", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^      model: vehicle && typeof vehicle.model === \"string\" ? vehicle.model : \"\",$/", "language": "JavaScript", "kind": "property", "scope": "dataService.createRequest.safeVehicle", "scopeKind": "class"}, {"_type": "tag", "name": "name", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^      name: contact?.name || \"\",$/", "language": "JavaScript", "kind": "property", "scope": "dataService.createRequest.safeContact", "scopeKind": "class"}, {"_type": "tag", "name": "normalizeContact", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^function normalizeContact(contact, row) {$/", "language": "JavaScript", "kind": "function", "signature": "(contact, row)"}, {"_type": "tag", "name": "normalizeSupabaseAuthError", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^function normalizeSupabaseAuthError(err) {$/", "language": "JavaScript", "kind": "function", "signature": "(err)"}, {"_type": "tag", "name": "normalizeVehicle", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^function normalizeVehicle(vehicle, row) {$/", "language": "JavaScript", "kind": "function", "signature": "(vehicle, row)"}, {"_type": "tag", "name": "notes", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^      notes: [],$/", "language": "JavaScript", "kind": "property", "scope": "dataService.createRequest.insertPayload", "scopeKind": "class"}, {"_type": "tag", "name": "phone", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^      phone: contact?.phone || \"\",$/", "language": "JavaScript", "kind": "property", "scope": "dataService.createRequest.safeContact", "scopeKind": "class"}, {"_type": "tag", "name": "register", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^  async register(email, password) {$/", "language": "JavaScript", "kind": "method", "signature": "(email, password)", "scope": "dataService", "scopeKind": "class"}, {"_type": "tag", "name": "safeContact", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^    const safeContact = {$/", "language": "JavaScript", "kind": "class", "scope": "dataService.createRequest", "scopeKind": "class"}, {"_type": "tag", "name": "safeVehicle", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^    const safeVehicle = {$/", "language": "JavaScript", "kind": "class", "scope": "dataService.createRequest", "scopeKind": "class"}, {"_type": "tag", "name": "status", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^      status: \"open\",$/", "language": "JavaScript", "kind": "property", "scope": "dataService.createRequest.insertPayload", "scopeKind": "class"}, {"_type": "tag", "name": "subscribeToAuthChanges", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^  subscribeToAuthChanges(onUserChanged) {$/", "language": "JavaScript", "kind": "method", "signature": "(onUserChanged)", "scope": "dataService", "scopeKind": "class"}, {"_type": "tag", "name": "supaUserToAppUser", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^async function supaUserToAppUser(supaUser) {$/", "language": "JavaScript", "kind": "function", "signature": "(supaUser)"}, {"_type": "tag", "name": "user_email", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^      user_email: user.email,$/", "language": "JavaScript", "kind": "property", "scope": "dataService.createRequest.insertPayload", "scopeKind": "class"}, {"_type": "tag", "name": "user_id", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^      user_id: user.id,$/", "language": "JavaScript", "kind": "property", "scope": "dataService.createRequest.insertPayload", "scopeKind": "class"}, {"_type": "tag", "name": "vehicle", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^      vehicle: safeVehicle,$/", "language": "JavaScript", "kind": "property", "scope": "dataService.createRequest.insertPayload", "scopeKind": "class"}], "hash": "887ef57ba48b8649986702e809753356", "format-version": 4, "code-base-name": "frontend_user_website", "filename": "frontend_user_website/src/services/dataService.js", "fields": [{"name": "assigned_mechanic_email: null,", "scope": "dataService.createRequest.insertPayload", "scopeKind": "class", "description": "unavailable"}, {"name": "assigned_mechanic_id: null,", "scope": "dataService.createRequest.insertPayload", "scopeKind": "class", "description": "unavailable"}, {"name": "contact: safeContact,", "scope": "dataService.createRequest.insertPayload", "scopeKind": "class", "description": "unavailable"}, {"name": "created_at: nowIso,", "scope": "dataService.createRequest.insertPayload", "scopeKind": "class", "description": "unavailable"}, {"name": "issue_description: issueDescription,", "scope": "dataService.createRequest.insertPayload", "scopeKind": "class", "description": "unavailable"}, {"name": "make: vehicle && typeof vehicle.make === \"string\" ? vehicle.make : \"\",", "scope": "dataService.createRequest.safeVehicle", "scopeKind": "class", "description": "unavailable"}, {"name": "model: vehicle && typeof vehicle.model === \"string\" ? vehicle.model : \"\",", "scope": "dataService.createRequest.safeVehicle", "scopeKind": "class", "description": "unavailable"}, {"name": "name: contact?.name || \"\",", "scope": "dataService.createRequest.safeContact", "scopeKind": "class", "description": "unavailable"}, {"name": "notes: [],", "scope": "dataService.createRequest.insertPayload", "scopeKind": "class", "description": "unavailable"}, {"name": "phone: contact?.phone || \"\",", "scope": "dataService.createRequest.safeContact", "scopeKind": "class", "description": "unavailable"}, {"name": "status: \"open\",", "scope": "dataService.createRequest.insertPayload", "scopeKind": "class", "description": "unavailable"}, {"name": "user_email: user.email,", "scope": "dataService.createRequest.insertPayload", "scopeKind": "class", "description": "unavailable"}, {"name": "user_id: user.id,", "scope": "dataService.createRequest.insertPayload", "scopeKind": "class", "description": "unavailable"}, {"name": "vehicle: safeVehicle,", "scope": "dataService.createRequest.insertPayload", "scopeKind": "class", "description": "unavailable"}]}