{"is_source_file": true, "format": "JavaScript", "description": "This file defines a data service module for a web application, primarily handling user authentication and CRUD operations related to requests in a service system. It interacts with Supabase as the backend, normalizes data formats, and provides methods for registration, login, user session management, and request management.", "external_files": ["./statusUtils", "./supabaseClient", "../config/appConfig", "../utils/withTimeout"], "external_methods": ["getSupabase", "normalizeStatus", "withTimeout"], "published": ["dataService"], "classes": [], "methods": [{"name": "supaUserToAppUser(supaUser)", "description": "Converts a Supabase user object into a simplified app-specific user object with role and approval status.", "scope": "", "scopeKind": ""}, {"name": "normalizeVehicle(vehicle, row)", "description": "Normalizes vehicle data from raw database rows or input objects into a standard {make, model} format.", "scope": "", "scopeKind": ""}, {"name": "normalizeContact(contact, row)", "description": "Normalizes contact data from raw database rows or input objects into a standard {name, phone} format.", "scope": "", "scopeKind": ""}, {"name": "normalizeSupabaseAuthError(err)", "description": "Converts various Supabase authentication errors into user-friendly messages.", "scope": "", "scopeKind": ""}, {"name": "register(email, password)", "description": "Registers a new user with email and password, returning their user info or throwing an error.", "scope": "dataService", "scopeKind": "class"}, {"name": "login(email, password)", "description": "Authenticates a user with email and password, returning user info.", "scope": "dataService", "scopeKind": "class"}, {"name": "loginWithGoogle({ redirectTo } = {})", "description": "Initiates OAuth login flow with Google provider.", "scope": "dataService", "scopeKind": "class"}, {"name": "logout()", "description": "Signs out the current user.", "scope": "dataService", "scopeKind": "class"}, {"name": "getUserFromSession()", "description": "Retrieves the current authenticated user based on session information.", "scope": "dataService", "scopeKind": "class"}, {"name": "getCurrentUser()", "description": "Returns the currently authenticated user, if any.", "scope": "dataService", "scopeKind": "class"}, {"name": "subscribeToAuthChanges(onUserChanged)", "description": "Subscribes to changes in authentication state, providing callbacks when user changes.", "scope": "dataService", "scopeKind": "class"}, {"name": "getProfile(userId)", "description": "Fetches the profile data for a given user ID.", "scope": "dataService", "scopeKind": "class"}, {"name": "listRequests({ forUserId } = {})", "description": "Retrieves a list of request records, optionally filtered by user ID.", "scope": "dataService", "scopeKind": "class"}, {"name": "getRequestById(requestId)", "description": "Fetches a single request record by its ID.", "scope": "dataService", "scopeKind": "class"}, {"name": "createRequest({ user, vehicle, issueDescription, contact, location } = {})", "description": "Creates a new service request entry with provided data, normalizing location, vehicle, and contact details.", "scope": "dataService", "scopeKind": "class"}, {"name": "isSupabaseConfigured()", "description": "Checks whether the Supabase environment variables are configured (always true in current implementation).", "scope": "dataService", "scopeKind": "class"}], "calls": ["getSupabase", "normalizeStatus", "withTimeout", "supaUserToAppUser", "supabase.from", "supabase.auth.signUp", "supabase.auth.signInWithPassword", "supabase.auth.signInWithOAuth", "supabase.auth.signOut", "supabase.auth.getSession", "supabase.auth.getUser"], "search-terms": ["dataService", "Supabase", "auth", "requests", "profiles", "vehicle normalization", "contact normalization", "OAuth Google", "request creation"], "state": 2, "file_id": 73, "knowledge_revision": 501, "git_revision": "a5ca0ae0caf4627deb85cb5c6ef9ab6eb2d5b760", "revision_history": [{"352": "15b5e00133c728e31f7cfdd11b3f578418e3e946"}, {"498": "4df64072ecff4147ced1d3bd08d6f9db6d098f5b"}, {"501": "a5ca0ae0caf4627deb85cb5c6ef9ab6eb2d5b760"}], "ctags": [{"_type": "tag", "name": "address", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^      address: safeAddress,$/", "language": "JavaScript", "kind": "property", "scope": "dataService.createRequest.insertPayload", "scopeKind": "class"}, {"_type": "tag", "name": "assigned_mechanic_email", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^      assigned_mechanic_email: null,$/", "language": "JavaScript", "kind": "property", "scope": "dataService.createRequest.insertPayload", "scopeKind": "class"}, {"_type": "tag", "name": "assigned_mechanic_id", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^      assigned_mechanic_id: null,$/", "language": "JavaScript", "kind": "property", "scope": "dataService.createRequest.insertPayload", "scopeKind": "class"}, {"_type": "tag", "name": "contact", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^      contact: safeContact,$/", "language": "JavaScript", "kind": "property", "scope": "dataService.createRequest.insertPayload", "scopeKind": "class"}, {"_type": "tag", "name": "createRequest", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^  async createRequest({ user, vehicle, issueDescription, contact, location } = {}) {$/", "language": "JavaScript", "kind": "method", "signature": "({ user, vehicle, issueDescription, contact, location } = {})", "scope": "dataService", "scopeKind": "class"}, {"_type": "tag", "name": "created_at", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^      created_at: nowIso,$/", "language": "JavaScript", "kind": "property", "scope": "dataService.createRequest.insertPayload", "scopeKind": "class"}, {"_type": "tag", "name": "dataService", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^export const dataService = {$/", "language": "JavaScript", "kind": "class"}, {"_type": "tag", "name": "getCurrentUser", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^  async getCurrentUser() {$/", "language": "JavaScript", "kind": "method", "signature": "()", "scope": "dataService", "scopeKind": "class"}, {"_type": "tag", "name": "getProfile", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^  async getProfile(userId) {$/", "language": "JavaScript", "kind": "method", "signature": "(userId)", "scope": "dataService", "scopeKind": "class"}, {"_type": "tag", "name": "getRequestById", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^  async getRequestById(requestId) {$/", "language": "JavaScript", "kind": "method", "signature": "(requestId)", "scope": "dataService", "scopeKind": "class"}, {"_type": "tag", "name": "getUserFromSession", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^  async getUserFromSession() {$/", "language": "JavaScript", "kind": "method", "signature": "()", "scope": "dataService", "scopeKind": "class"}, {"_type": "tag", "name": "insertPayload", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^    const insertPayload = {$/", "language": "JavaScript", "kind": "class", "scope": "dataService.createRequest", "scopeKind": "class"}, {"_type": "tag", "name": "isSupabaseConfigured", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^  isSupabaseConfigured() {$/", "language": "JavaScript", "kind": "method", "signature": "()", "scope": "dataService", "scopeKind": "class"}, {"_type": "tag", "name": "issue_description", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^      issue_description: issueDescription,$/", "language": "JavaScript", "kind": "property", "scope": "dataService.createRequest.insertPayload", "scopeKind": "class"}, {"_type": "tag", "name": "lat", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^      lat: safeLat,$/", "language": "JavaScript", "kind": "property", "scope": "dataService.createRequest.insertPayload", "scopeKind": "class"}, {"_type": "tag", "name": "listRequests", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^  async listRequests({ forUserId } = {}) {$/", "language": "JavaScript", "kind": "method", "signature": "({ forUserId } = {})", "scope": "dataService", "scopeKind": "class"}, {"_type": "tag", "name": "login", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^  async login(email, password) {$/", "language": "JavaScript", "kind": "method", "signature": "(email, password)", "scope": "dataService", "scopeKind": "class"}, {"_type": "tag", "name": "loginWithGoogle", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^  async loginWithGoogle({ redirectTo } = {}) {$/", "language": "JavaScript", "kind": "method", "signature": "({ redirectTo } = {})", "scope": "dataService", "scopeKind": "class"}, {"_type": "tag", "name": "logout", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^  async logout() {$/", "language": "JavaScript", "kind": "method", "signature": "()", "scope": "dataService", "scopeKind": "class"}, {"_type": "tag", "name": "lon", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^      lon: safeLon,$/", "language": "JavaScript", "kind": "property", "scope": "dataService.createRequest.insertPayload", "scopeKind": "class"}, {"_type": "tag", "name": "make", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^      make: vehicle && typeof vehicle.make === \"string\" ? vehicle.make : \"\",$/", "language": "JavaScript", "kind": "property", "scope": "dataService.createRequest.safeVehicle", "scopeKind": "class"}, {"_type": "tag", "name": "model", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^      model: vehicle && typeof vehicle.model === \"string\" ? vehicle.model : \"\",$/", "language": "JavaScript", "kind": "property", "scope": "dataService.createRequest.safeVehicle", "scopeKind": "class"}, {"_type": "tag", "name": "name", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^      name: contact?.name || \"\",$/", "language": "JavaScript", "kind": "property", "scope": "dataService.createRequest.safeContact", "scopeKind": "class"}, {"_type": "tag", "name": "normalizeContact", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^function normalizeContact(contact, row) {$/", "language": "JavaScript", "kind": "function", "signature": "(contact, row)"}, {"_type": "tag", "name": "normalizeSupabaseAuthError", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^function normalizeSupabaseAuthError(err) {$/", "language": "JavaScript", "kind": "function", "signature": "(err)"}, {"_type": "tag", "name": "normalizeVehicle", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^function normalizeVehicle(vehicle, row) {$/", "language": "JavaScript", "kind": "function", "signature": "(vehicle, row)"}, {"_type": "tag", "name": "notes", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^      notes: [],$/", "language": "JavaScript", "kind": "property", "scope": "dataService.createRequest.insertPayload", "scopeKind": "class"}, {"_type": "tag", "name": "phone", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^      phone: contact?.phone || \"\",$/", "language": "JavaScript", "kind": "property", "scope": "dataService.createRequest.safeContact", "scopeKind": "class"}, {"_type": "tag", "name": "register", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^  async register(email, password) {$/", "language": "JavaScript", "kind": "method", "signature": "(email, password)", "scope": "dataService", "scopeKind": "class"}, {"_type": "tag", "name": "safeContact", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^    const safeContact = {$/", "language": "JavaScript", "kind": "class", "scope": "dataService.createRequest", "scopeKind": "class"}, {"_type": "tag", "name": "safeVehicle", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^    const safeVehicle = {$/", "language": "JavaScript", "kind": "class", "scope": "dataService.createRequest", "scopeKind": "class"}, {"_type": "tag", "name": "subscribeToAuthChanges", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^  subscribeToAuthChanges(onUserChanged) {$/", "language": "JavaScript", "kind": "method", "signature": "(onUserChanged)", "scope": "dataService", "scopeKind": "class"}, {"_type": "tag", "name": "supaUserToAppUser", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^async function supaUserToAppUser(supaUser) {$/", "language": "JavaScript", "kind": "function", "signature": "(supaUser)"}, {"_type": "tag", "name": "user_email", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^      user_email: user.email,$/", "language": "JavaScript", "kind": "property", "scope": "dataService.createRequest.insertPayload", "scopeKind": "class"}, {"_type": "tag", "name": "user_id", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^      user_id: user.id,$/", "language": "JavaScript", "kind": "property", "scope": "dataService.createRequest.insertPayload", "scopeKind": "class"}, {"_type": "tag", "name": "vehicle", "path": "/home/kavia/workspace/code-generation/roadrescue-quickassist-platform-41193-41202/frontend_user_website/src/services/dataService.js", "pattern": "/^      vehicle: safeVehicle,$/", "language": "JavaScript", "kind": "property", "scope": "dataService.createRequest.insertPayload", "scopeKind": "class"}], "hash": "3fefbcb08561874787d8de5cc8b71b74", "format-version": 4, "code-base-name": "frontend_user_website", "filename": "frontend_user_website/src/services/dataService.js", "fields": [{"name": "address: safeAddress,", "scope": "dataService.createRequest.insertPayload", "scopeKind": "class", "description": "unavailable"}, {"name": "assigned_mechanic_email: null,", "scope": "dataService.createRequest.insertPayload", "scopeKind": "class", "description": "unavailable"}, {"name": "assigned_mechanic_id: null,", "scope": "dataService.createRequest.insertPayload", "scopeKind": "class", "description": "unavailable"}, {"name": "contact: safeContact,", "scope": "dataService.createRequest.insertPayload", "scopeKind": "class", "description": "unavailable"}, {"name": "created_at: nowIso,", "scope": "dataService.createRequest.insertPayload", "scopeKind": "class", "description": "unavailable"}, {"name": "issue_description: issueDescription,", "scope": "dataService.createRequest.insertPayload", "scopeKind": "class", "description": "unavailable"}, {"name": "lat: safeLat,", "scope": "dataService.createRequest.insertPayload", "scopeKind": "class", "description": "unavailable"}, {"name": "lon: safeLon,", "scope": "dataService.createRequest.insertPayload", "scopeKind": "class", "description": "unavailable"}, {"name": "make: vehicle && typeof vehicle.make === \"string\" ? vehicle.make : \"\",", "scope": "dataService.createRequest.safeVehicle", "scopeKind": "class", "description": "unavailable"}, {"name": "model: vehicle && typeof vehicle.model === \"string\" ? vehicle.model : \"\",", "scope": "dataService.createRequest.safeVehicle", "scopeKind": "class", "description": "unavailable"}, {"name": "name: contact?.name || \"\",", "scope": "dataService.createRequest.safeContact", "scopeKind": "class", "description": "unavailable"}, {"name": "notes: [],", "scope": "dataService.createRequest.insertPayload", "scopeKind": "class", "description": "unavailable"}, {"name": "phone: contact?.phone || \"\",", "scope": "dataService.createRequest.safeContact", "scopeKind": "class", "description": "unavailable"}, {"name": "user_email: user.email,", "scope": "dataService.createRequest.insertPayload", "scopeKind": "class", "description": "unavailable"}, {"name": "user_id: user.id,", "scope": "dataService.createRequest.insertPayload", "scopeKind": "class", "description": "unavailable"}, {"name": "vehicle: safeVehicle,", "scope": "dataService.createRequest.insertPayload", "scopeKind": "class", "description": "unavailable"}]}